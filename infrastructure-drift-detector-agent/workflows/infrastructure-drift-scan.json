{
  "name": "infrastructure-drift-scan",
  "description": "Comprehensive infrastructure drift detection and compliance workflow",
  "schedule": {
    "cron": "0 */4 * * *",
    "timezone": "UTC"
  },
  "steps": [
    {
      "name": "fetch_terraform_state",
      "type": "data_query",
      "datasource": "terraform_state",
      "query": "Get current Terraform state for all workspaces"
    },
    {
      "name": "scan_aws_resources",
      "type": "data_query",
      "datasource": "aws_api",
      "query": "Get actual AWS resource configurations"
    },
    {
      "name": "fetch_iac_templates",
      "type": "data_query",
      "datasource": "git_repository",
      "query": "Get latest Infrastructure as Code templates"
    },
    {
      "name": "detect_configuration_drift",
      "type": "analysis",
      "input": ["fetch_terraform_state", "scan_aws_resources", "fetch_iac_templates"],
      "criteria": {
        "drift_sensitivity": "medium",
        "ignore_metadata_changes": true,
        "critical_resources": ["security-groups", "iam-roles", "s3-buckets"]
      }
    },
    {
      "name": "assess_drift_impact",
      "type": "analysis",
      "input": ["detect_configuration_drift"],
      "criteria": {
        "risk_factors": ["security", "compliance", "cost"],
        "impact_threshold": "medium",
        "business_criticality": true
      }
    },
    {
      "name": "generate_drift_report",
      "type": "report_generation",
      "template": "infrastructure_drift_summary",
      "input": ["assess_drift_impact"]
    },
    {
      "name": "send_drift_alert",
      "type": "notification",
      "datasource": "slack",
      "input": ["generate_drift_report"]
    }
  ]
}